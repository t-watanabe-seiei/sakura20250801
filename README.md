# 小学1年生向け減法練習Webアプリ

## アプリ概要
このWebアプリは、小学1年生が「10以下の数から1位数をひく減法」を楽しく練習できる学習ツールです。問題はランダムに出題され、解答結果はすぐにフィードバックされます。履歴も自動で保存され、保護者や先生が学習状況を確認できます。

**【新機能】** むずかしいレベル（11～19から1～9を引く減法）も練習できるようになりました！

## 使い方
1. アプリにアクセスすると、減法問題が表示されます。
2. 答えを入力して「こたえを送信」ボタンを押します。
3. 正誤判定が表示され、次の問題に進めます。
4. 「これまでのれきしを見る」ボタンで過去の解答履歴を確認できます。
5. 「むずかしいレベルにチャレンジ」リンクから難易度の高い問題に挑戦できます。

## レベル選択
### 通常レベル（`/`）
- 10以下の数から1位数をひく減法
- 例：5 - 3、10 - 7 など

### むずかしいレベル（`/advanced`）
- 11～19の数から1～9をひく減法
- 例：15 - 7、18 - 9 など

## 特徴
- ログイン不要、個人情報不要で安心
- 小学校1年生でも直感的に使えるシンプルなデザイン
- 履歴は匿名（セッションID）で保存
- 端末・ブラウザ問わず利用可能
- 2つの難易度レベルで段階的に学習

## 画面構成
### 通常レベル
- トップページ（`/`）：減法問題の出題・解答フォーム
- 結果表示ページ（`/answer`）：正誤判定と次の問題への誘導
- 履歴ページ（`/history`）：過去の解答履歴一覧

### むずかしいレベル
- 問題ページ（`/advanced`）：減法問題の出題・解答フォーム
- 結果表示ページ（`/advanced/answer`）：正誤判定と次の問題への誘導
- 履歴ページ（`/advanced/history`）：過去の解答履歴一覧

## インストール・起動方法
1. 必要なパッケージをインストール
   ```bash
   composer install
   npm install && npm run dev
   ```

1.1 .env ファイルのReName
   ```bash
    mv .env.example .env
   ```
1.2 APP_KEY の更新
   ```bash
    php artisan key:generate
   ```


2.0 データベース
   ```bash
   touch database/database.sqlite
   ```

2. データベースを初期化
   ```bash
   php artisan migrate
   ```
3. サーバーを起動
   ```bash
   php artisan serve
   ```

## .envのMIX_ASSET_URLについて
CSSやJSのパスは、.envのMIX_ASSET_URLでベースURLを指定できます。
例：
```
MIX_ASSET_URL="/"
```

**重要**: すべてのページ遷移はLaravelの`route()`ヘルパーを使用しているため、サブディレクトリに配置する場合でも自動的に正しいパスが生成されます。

Bladeテンプレートでは
```blade
<link rel="stylesheet" href="{{ mix('css/app.css') }}">
<script src="{{ mix('js/app.js') }}" defer></script>
```
で自動的にMIX_ASSET_URLが反映されます。

ページ遷移には`route()`ヘルパーを使用：
```blade
<a href="{{ route('advanced.show') }}">むずかしいレベル</a>
<a href="{{ route('subtraction.show') }}">通常レベル</a>
```
```blade
<link rel="stylesheet" href="{{ mix('css/app.css') }}">
<script src="{{ mix('js/app.js') }}" defer></script>
```
で自動的にMIX_ASSET_URLが反映されます。

## テスト実行方法
```bash
php artisan test
```

## 注意事項
- 通常レベルでは「10以下の数から1位数をひく減法」が出題されます。
- むずかしいレベルでは「11～19の数から1～9をひく減法」が出題されます。
- 履歴はセッション単位で保存されます。
- 保護者・教師は履歴ページで学習状況を確認できます。
- 履歴は1ページ20件ずつ表示され、ページネーションで閲覧できます。
- 日付ごとの正答率が自動で計算されます。

## アニメーション機能
### 正解時のアニメーション
- **通常の正解**：星（⭐✨🌟）が画面上を舞うアニメーション
- **3問連続正解**：連続正解バッジ（⭐）が表示される
- **5問連続正解**：豪華な演出
  - カラフルな紙吹雪が降る
  - 花火エフェクトが3回発生
  - 特別な連続正解メッセージと記念バッジ（🏆）
  - 豪華な効果音（3音階）

### 効果音
- Web Audio APIを使用した効果音が再生されます
- 通常正解：2音階の軽快な音
- 5問連続正解：3音階の豪華な音

## 更新履歴
### 2026-01-17
- **[改善]** すべてのビューファイルでハードコードされたパスを`route()`ヘルパーに変更
  - サブディレクトリへの配置に対応
  - より保守性の高いコードに改善
  - `/advanced`, `/advanced/answer`, `/advanced/history` などをすべて`route()`に統一

### 2026-01-16 (3回目の更新)
- **[機能追加]** 正解時のアニメーション機能を追加
  - 通常正解：星が舞うアニメーション
  - 3問連続正解：連続正解バッジ表示
  - 5問連続正解：紙吹雪と花火の豪華な演出
- **[機能追加]** 連続正解カウント機能を追加（セッションで管理）
- **[機能追加]** Web Audio APIによる効果音を追加
- 通常レベルとむずかしいレベルの両方に対応（連続カウントは別管理）

### 2026-01-16 (2回目の更新)
- **[機能追加]** 履歴ページにページネーション機能を追加（1ページ20件表示）
- **[機能追加]** 日付ごとの正答率の表示機能を追加
- **[機能追加]** 履歴をリセットするボタンを追加（自分のセッションの履歴のみ削除）
- 通常レベル、むずかしいレベルの両方に対応

### 2026-01-16
- **[機能追加]** むずかしいレベル（11～19から1～9を引く減法）を追加
  - 新しいコントローラー：`AdvancedSubtractionProblemController`
  - 新しいモデル：`AdvancedSubtractionProblem`
  - 新しいデータベーステーブル：`advanced_subtraction_histories`
  - 新しいルート：`/advanced`, `/advanced/answer`, `/advanced/history`
  - 新しいビュー：`resources/views/advanced_subtraction/`配下
  - 通常レベルとむずかしいレベルは別々のテーブルで管理されます

